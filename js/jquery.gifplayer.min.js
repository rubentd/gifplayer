(function(b){function a(d,c){this.previewElement=d;this.spinnerElement=b("<div class = 'spinner'></div>");this.options=c;this.gifLoaded=false}a.prototype={activate:function(){this.wrap();this.addSpinner();this.addControl();this.addEvents()},wrap:function(){this.wrapper=this.previewElement.wrap("<div class='gifplayer-wrapper'></div>").parent();this.wrapper.css("width",this.previewElement.width());this.wrapper.css("height",this.previewElement.height());this.previewElement.addClass("gifplayer");this.previewElement.css("cursor","pointer")},getGifSrc:function(){var c="-"+this.previewElement.width()+"x"+this.previewElement.height();var d=this.previewElement.attr("src").replace(c,"").replace(".png",".gif");return d},addControl:function(){this.playElement=b("<ins class='play-gif'>"+this.options.label+"</ins>");this.playElement.css("left",this.previewElement.width()/2+this.playElement.width()/2);this.wrapper.append(this.playElement)},addEvents:function(){var c=this;if(c.options.autoLoad){c.playElement.hide();c.spinnerElement.show();c.loadGif()}c.playElement.on("click",function(d){b(this).hide();c.spinnerElement.show();c.loadGif();d.preventDefault();d.stopPropagation()});c.previewElement.on("click",function(d){if(c.playElement.is(":visible")){c.playElement.hide();c.spinnerElement.show();c.loadGif()}d.preventDefault();d.stopPropagation()});c.spinnerElement.on("click",function(d){d.preventDefault();d.stopPropagation()})},loadGif:function(){if(!this.gifLoaded){this.enableAbort()}var f=this.getGifSrc();var d=this.previewElement.width();var c=this.previewElement.height();this.gifElement=b("<img src='"+f+"' width='"+d+"' height=' "+c+" '/>");var e=this;this.gifElement.load(function(){e.gifLoaded=true;e.resetEvents();b(this).css("cursor","pointer");b(this).css("position","absolute");b(this).css("top","0");b(this).css("left","0");e.previewElement.hide();e.wrapper.append(e.gifElement);e.spinnerElement.hide();b(this).click(function(g){b(this).remove();e.previewElement.show();e.playElement.show();g.preventDefault();g.stopPropagation()})})},enableAbort:function(){var c=this;this.previewElement.click(function(d){c.abortLoading(d)});this.spinnerElement.click(function(d){c.abortLoading(d)})},abortLoading:function(c){this.spinnerElement.hide();this.playElement.show();c.preventDefault();c.stopPropagation();this.gifElement.off("load").on("load",function(d){d.preventDefault();d.stopPropagation()});this.resetEvents()},resetEvents:function(){this.previewElement.off("click");this.playElement.off("click");this.spinnerElement.off("click");this.addEvents()},addSpinner:function(){this.wrapper.append(this.spinnerElement);this.spinnerElement.hide()}};b.fn.gifplayer=function(c){return this.each(function(){c=b.extend({},b.fn.gifplayer.defaults,c);var d=new a(b(this),c);d.activate()})};b.fn.gifplayer.defaults={label:"gif",autoLoad:false}})(jQuery);